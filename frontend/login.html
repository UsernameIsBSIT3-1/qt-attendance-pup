<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login — PUP Attendance</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { pup: { maroon: '#800000', gold: '#DAA520' } } } }
    }
  </script>
  <script>
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css" />
</head>
<body class="bg-[#800000] dark:bg-slate-900 flex items-center justify-center min-h-screen relative overflow-hidden transition-colors">

  <div class="absolute -top-20 -left-20 w-64 h-64 bg-[#DAA520] rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
  <div class="absolute -bottom-20 -right-20 w-64 h-64 bg-[#DAA520] rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>

  <button onclick="toggleTheme()" class="absolute top-6 right-6 text-white/70 hover:text-white transition-colors z-20">
    <i class="fa-solid fa-circle-half-stroke fa-xl"></i>
  </button>

  <div class="w-full max-w-sm bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-2xl z-10 animate-fade">
    <div class="text-center mb-8">
      <div class="w-16 h-16 bg-[#800000] dark:bg-[#DAA520] rounded-full flex items-center justify-center mx-auto mb-4 text-white dark:text-[#800000] shadow-lg transition-colors">
        <i class="fa-solid fa-graduation-cap fa-2x"></i>
      </div>
      <h1 class="text-2xl font-bold text-slate-800 dark:text-white">PUP Attendance</h1>
      <p class="text-sm text-slate-500 dark:text-slate-400">Sign in to your account</p>
    </div>

    <form id="loginForm" class="space-y-5">
      <div>
        <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-1">Student No. / Username</label>
        <div class="relative">
          <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400"><i class="fa-solid fa-user"></i></span>
          <input id="username" type="text" required class="input pl-10" placeholder="e.g. 2023-00164-PQ-0 or faculty">
        </div>
      </div>

      <div>
        <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-1">Password</label>
        <div class="relative">
          <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400"><i class="fa-solid fa-lock"></i></span>
          <input id="password" type="password" required class="input pl-10" placeholder="••••••••">
        </div>
      </div>

      <div id="errorMsg" class="text-red-600 dark:text-red-400 text-sm text-center hidden bg-red-50 dark:bg-red-900/20 p-2 rounded">
        Invalid credentials
      </div>

      <button type="submit" class="w-full bg-[#800000] hover:bg-[#9a1a1a] text-white font-bold py-3 rounded-xl transition-all shadow-lg hover:shadow-xl dark:bg-[#DAA520] dark:text-[#800000] dark:hover:bg-[#FFD700]">
        Sign In
      </button>
    </form>
    
    <div class="mt-8 text-center text-xs text-slate-400 dark:text-slate-500">
      Polytechnic University of the Philippines<br>Group 10
    </div>
  </div>

<script src="js/api.js"></script>
<script>
  if (localStorage.getItem('token')) {
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    if (user.role === 'admin') location.href = 'admin.html';
    else if (user.role === 'student') location.href = 'student-dashboard.html';
    else location.href = 'index.html';
  }

  document.getElementById('loginForm').onsubmit = async (e) => {
    e.preventDefault();
    const btn = e.target.querySelector('button');
    const err = document.getElementById('errorMsg');
    
    err.classList.add('hidden');
    btn.disabled = true;
    btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Signing in...';

    const userIn = document.getElementById('username').value;
    const passIn = document.getElementById('password').value;

    try {
      const res = await login(userIn, passIn);
      if (res.token) {
        localStorage.setItem('token', res.token);
        localStorage.setItem('user', JSON.stringify(res.user));
        if (res.user.role === 'admin') window.location.href = 'admin.html';
        else if (res.user.role === 'student') window.location.href = 'student-dashboard.html';
        else window.location.href = 'index.html';
      } else {
        throw new Error(res.error || 'Login failed');
      }
    } catch (error) {
      err.innerText = "Invalid username or password.";
      err.classList.remove('hidden');
      btn.disabled = false;
      btn.innerText = "Sign In";
    }
  };
</script>
</body>
</html>