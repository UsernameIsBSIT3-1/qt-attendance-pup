<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>QR Scanner - PUP Attendance</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <div class="app">
    <div class="sidebar">
      <h2>Group 10</h2>
      <div style="font-size:13px;color:#cfd8dc">QR Attendance</div>
      <button onclick="location.href='index.html'">Dashboard</button>
      <button onclick="location.href='scan.html'">Scan</button>
      <button onclick="location.href='reports.html'">Reports</button>
    </div>

    <div class="main">
      <div class="header">
        <h1>Scanner</h1>
        <div></div>
      </div>

      <div class="card" style="text-align:center">
        <h3>Live QR Scanner</h3>
        <div id="reader" style="width:500px; margin: 12px auto;"></div>
        <p id="scan-result">No scan yet.</p>
      </div>
    </div>
  </div>

<script src="js/scanner.js"></script>
<script>
const resultEl = document.getElementById('scan-result');

function onScanSuccess(decodedText, decodedResult) {
  resultEl.innerText = 'Scanned: ' + decodedText;
  // post to backend & show toast
  fetch('/api/attendance', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ qr: decodedText })
  })
  .then(r => r.json())
  .then(res => {
    resultEl.innerText = 'Logged: ' + decodedText + ' (' + new Date().toLocaleTimeString() + ')';
  })
  .catch(err => {
    resultEl.innerText = 'Error logging';
    console.error(err);
  });
}

function onScanFailure(error) {
  // console.warn(`QR error: ${error}`);
}

const html5QrcodeScanner = new Html5QrcodeScanner(
  "reader", { fps: 10, qrbox: 250 }
);
html5QrcodeScanner.render(onScanSuccess, onScanFailure);
</script>
</body>
</html>
